# Makefile for the SNOPT7 library
# by Stefan Koerkel, 2011

.SUFFIXES:
.SUFFIXES: .so .o. f

FC        = gfortran
FFLAGS    = -O0 -fPIC -shared -g
OBJ       = $(PWD)/obj
LIB       = $(PWD)/lib

SNOPTOBJ  = $(OBJ)/sqopt.o \
		    $(OBJ)/snopta.o \
		    $(OBJ)/snoptb.o \
		    $(OBJ)/snoptc.o \
		    $(OBJ)/snoptq.o \
		    $(OBJ)/npopt.o \
		    $(OBJ)/sq02lib.o \
		    $(OBJ)/sn02lib.o \
		    $(OBJ)/np02lib.o \
		    $(OBJ)/sn03prnt.o \
		    $(OBJ)/sn05wrpa.o \
		    $(OBJ)/sn05wrpb.o \
		    $(OBJ)/sn05wrpc.o \
		    $(OBJ)/sn05wrpn.o \
		    $(OBJ)/sn10mach.o \
		    $(OBJ)/sn12ampl.o \
		    $(OBJ)/sn17util.o \
		    $(OBJ)/sn20amat.o \
		    $(OBJ)/sn25bfac.o \
		    $(OBJ)/sn27lu.o \
		    $(OBJ)/sn30spec.o \
		    $(OBJ)/sn35mps.o \
		    $(OBJ)/sn37wrap.o \
		    $(OBJ)/sn40bfil.o \
		    $(OBJ)/sn50lp.o \
		    $(OBJ)/sn55qp.o \
		    $(OBJ)/sn56qncg.o \
		    $(OBJ)/sn57qopt.o \
		    $(OBJ)/sn60srch.o \
		    $(OBJ)/sn65rmod.o \
		    $(OBJ)/sn70nobj.o \
		    $(OBJ)/sn80ncon.o \
		    $(OBJ)/sn85hess.o \
		    $(OBJ)/sn87sopt.o \
		    $(OBJ)/sn90lmqn.o \
		    $(OBJ)/sn95fmqn.o

all: $(LIB)/libsnopt7.so

$(LIB)/libsnopt7.so: $(SNOPTOBJ) | $(LIB)
	ld -shared -s -o $@ $(SNOPTOBJ) -lgfortran -lblas

$(OBJ)/%.o: $(PWD)/src/%.f | $(OBJ)
	$(FC) -c $(FFLAGS) -o $@ $< -lgfortran -lblas

$(OBJ):
	-mkdir $@

$(LIB):
	-mkdir $@

clean:
	-rm -Rf $(OBJ) $(LIB)
